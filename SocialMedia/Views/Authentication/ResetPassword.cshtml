@using Models
@model ResetPasswordModel

<div class="sm:flex">
    @* Form section (Cột Trái) *@
    <div class="relative lg:w-[580px] md:w-96 w-full p-10 min-h-screen bg-white shadow-xl flex items-center pt-10 z-10">
        <div class="w-full lg:max-w-sm mx-auto space-y-10">
            <div>
                <h2 class="text-2xl font-semibold mb-1.5">Đặt lại Mật khẩu</h2>

                @* Hiển thị thông báo OTP đã gửi từ ForgotPassword (nếu có) *@
                @if (TempData["ResetPasswordMessage"] != null)
                {
                    <p class="text-sm text-green-600 font-normal">
                        <ion-icon name="mail-open-outline"></ion-icon> @TempData["ResetPasswordMessage"]
                    </p>
                }
                <p class="text-sm text-gray-700 font-normal mt-2">
                    Email đang đặt lại: <strong>@Model.Email</strong>
                </p>
            </div>

            <form asp-controller="Authentication" asp-action="ResetPassword" method="post" class="space-y-7 text-sm text-black font-medium">
                @* Hiển thị lỗi tổng quát (ModelOnly) và giữ email *@
                <div class="col-span-2 text-red-500" asp-validation-summary="ModelOnly"></div>

                @* Trường ẩn lưu Email (quan trọng để gửi lên POST Action) *@
                <input type="hidden" asp-for="Email" />

                <div>
                    <label asp-for="Otp">Mã OTP</label>
                    <div class="mt-2.5">
                        <input asp-for="Otp" type="text" placeholder="Nhập Mã OTP 6 chữ số" required class="!w-full" maxlength="6" />
                        <span asp-validation-for="Otp" class="text-red-500 text-xs mt-1"></span>
                    </div>
                </div>

                <div>
                    <label asp-for="NewPassword">Mật khẩu mới</label>
                    <div class="mt-2.5 password-container">
                        <input asp-for="NewPassword" id="new-password-field" type="password" placeholder="Mật khẩu mới (ít nhất 6 ký tự)" required class="!w-full" />
                        @* Thêm nút ẩn/hiện mật khẩu *@
                        <button type="button" onclick="togglePasswordVisibility('new-password-field')">👁️</button>
                        <span asp-validation-for="NewPassword" class="text-red-500 text-xs mt-1"></span>
                    </div>
                </div>

                <div>
                    <label asp-for="ConfirmPassword">Xác nhận Mật khẩu mới</label>
                    <div class="mt-2.5 password-container">
                        <input asp-for="ConfirmPassword" id="confirm-password-field" type="password" placeholder="Xác nhận Mật khẩu" required class="!w-full" />
                        @* Thêm nút ẩn/hiện mật khẩu *@
                        <button type="button" onclick="togglePasswordVisibility('confirm-password-field')">👁️</button>
                        <span asp-validation-for="ConfirmPassword" class="text-red-500 text-xs mt-1"></span>
                    </div>
                </div>

                <div>
                    <button type="submit" class="button bg-primary text-white w-full">Đặt lại Mật khẩu</button>
                </div>

                <div class="text-center mt-5">
                    <p class="text-sm text-gray-700">Chưa nhận được mã?</p>
                    <a asp-controller="Authentication" asp-action="ForgotPassword" class="text-blue-700 hover:underline font-normal">Gửi lại OTP</a>
                </div>
            </form>
        </div>
    </div>

    @* Image slider (Cột Phải - Dùng lại style từ Login/Register) *@
    <div class="flex-1 relative bg-primary max-md:hidden">
        <div class="relative w-full h-full" tabindex="-1" uk-slideshow="animation: slide; autoplay: true">
            <ul class="uk-slideshow-items w-full h-full">
                <li class="w-full">
                    <img src="~/images/welcome/welcome-01.png" alt="" class="w-full h-full object-cover uk-animation-kenburns uk-animation-reverse uk-transform-origin-center-left">
                    <div class="absolute bottom-0 w-full uk-transition-slide-bottom-small z-10">
                        <div class="max-w-xl w-full mx-auto pb-32 px-5 z-30 relative">
                            <h4 class="!text-white text-2xl font-semibold mt-7" uk-slideshow-parallax="y: 600,0,0">Bảo mật tài khoản của bạn</h4>
                            <p class="!text-white text-lg mt-7 leading-8" uk-slideshow-parallax="y: 800,0,0;">Đặt lại mật khẩu an toàn và nhanh chóng để tiếp tục trải nghiệm mạng xã hội của chúng tôi.</p>
                        </div>
                    </div>
                    <div class="w-full h-96 bg-gradient-to-t from-black absolute bottom-0 left-0"></div>
                </li>
                <li class="w-full">
                    <img src="~/images/welcome/welcome-02.png" alt="" class="w-full h-full object-cover uk-animation-kenburns uk-animation-reverse uk-transform-origin-center-left">
                    <div class="absolute bottom-0 w-full uk-tr ansition-slide-bottom-small z-10">
                        <div class="max-w-xl w-full mx-auto pb-32 px-5 z-30 relative">
                            <h4 class="!text-white text-2xl font-semibold mt-7" uk-slideshow-parallax="y: 800,0,0"> Kết nối trở lại </h4>
                            <p class="!text-white text-lg mt-7 leading-8" uk-slideshow-parallax="y: 800,0,0;"> Đừng để mật khẩu cản trở bạn! Hoàn tất đặt lại để kết nối với bạn bè.</p>
                        </div>
                    </div>
                    <div class="w-full h-96 bg-gradient-to-t from-black absolute bottom-0 left-0"></div>
                </li>
            </ul>
            <div class="flex justify-center">
                <ul class="inline-flex flex-wrap justify-center  absolute bottom-8 gap-1.5 uk-dotnav uk-slideshow-nav"> </ul>
            </div>
        </div>
    </div>
</div>

@* Script cho nút ẩn/hiện mật khẩu *@
<script>
    function togglePasswordVisibility(fieldId) {
        const field = document.getElementById(fieldId);
        if (field.type === "password") {
            field.type = "text";
        } else {
            field.type = "password";
        }
    }
</script>