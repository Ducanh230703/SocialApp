@{
    ViewData["Title"] = "Change Password";
}

<div class="max-w-md mx-auto mt-10 bg-white p-6 shadow-lg rounded-lg">
    <h2 class="text-xl font-semibold mb-4">🔒 Thay đổi mật khẩu</h2>

    <form id="changePasswordForm" class="space-y-4">
        <div>
            <label class="block text-sm text-gray-700 mb-1">Mật khẩu hiện tại</label>
            <input type="password" name="OldPassword" class="w-full border rounded-md p-2" required />
        </div>

        <div>
            <label class="block text-sm text-gray-700 mb-1">Mật khẩu mới</label>
            <input type="password" name="NewPassword" class="w-full border rounded-md p-2" required />
        </div>

        <div>
            <label class="block text-sm text-gray-700 mb-1">Xác nhận mật khẩu mới</label>
            <input type="password" name="ConfirmPassword" class="w-full border rounded-md p-2" required />
        </div>

        <div class="flex justify-end space-x-3">
            <a asp-controller="Setting" asp-action="Index"
               class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300">Hủy</a>
            <button type="submit"
                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                Lưu thay đổi
            </button>
        </div>
    </form>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    function showPopup(title, message, success = true) {
        Swal.fire({
            title: title,
            text: message,
            icon: success ? "success" : "error",
            confirmButtonText: "OK"
        });
    }

    document.getElementById("changePasswordForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());

        const response = await fetch("/User/ChangePassword", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.status === 1) {
            showPopup("Thành công", result.mess || "Đổi mật khẩu thành công!");
        } else {
            showPopup("Lỗi", result.mess || "Đổi mật khẩu thất bại!", false);
        }
    });
</script>
