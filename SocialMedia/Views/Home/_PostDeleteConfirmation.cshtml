<div id="postDeleteDialog" uk-modal>
    <div class="uk-modal-dialog relative mx-auto bg-white rounded-lg shadow-xl w-[400px]">
        <div class="p-6">
            <h2 class="text-xl font-bold text-gray-800">Xác nhận Xóa</h2>
        </div>

        <div class="p-6 py-0">
            <p class="text-gray-600">Bạn có chắc chắn muốn xóa bài viết này không? Hành động này không thể hoàn tác.</p>
        </div>

        <div class="flex justify-end p-6 text-sm font-medium border-t mt-4">
            <input type="hidden" id="deleteConfirmationPostId" />

            <button type="button" class="px-4 py-2 rounded-lg uk-modal-close text-gray-600 hover:bg-gray-100 transition-colors mr-3">Hủy</button>

            <button type="button" id="confirmDeleteBtn" class="px-5 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors shadow-md">Xóa</button>
        </div>

        <button type="button" class="bg-white rounded-full p-2 absolute right-0 top-0 m-3 uk-modal-close text-gray-400 hover:text-gray-900 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const deleteConfirmationPostId = document.getElementById('deleteConfirmationPostId');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

        // --- 1. Hàm hiển thị Modal Xóa ---
        // Hàm này sẽ được gọi từ nút "Xóa" trên bài viết
        window.openDeleteModal = function (postId) {
            deleteConfirmationPostId.value = postId; // Lưu ID bài viết vào input ẩn

            if (typeof UIkit !== 'undefined' && UIkit.modal) {
                UIkit.modal('#postDeleteDialog').show();
            } else {
                console.error("UIkit không được tải.");
                alert("Không thể mở hộp thoại xác nhận.");
            }
        };

        // --- 2. Xử lý sự kiện khi nút "Xóa" trong Modal được click ---
        confirmDeleteBtn.addEventListener('click', function () {
            const postId = deleteConfirmationPostId.value;

            if (!postId) {
                alert("Lỗi: Không tìm thấy ID bài viết.");
                return;
            }

            // Vô hiệu hóa nút và thay đổi trạng thái
            confirmDeleteBtn.textContent = 'Đang xóa...';
            confirmDeleteBtn.disabled = true;

            // Gửi yêu cầu DELETE (hoặc POST) đến API
            fetch(`/Home/DeletePost?postId=${postId}`, {
                method: 'DELETE', // Thường dùng POST hoặc DELETE
                headers: {
                    'Content-Type': 'application/json'
                    // Thêm Anti-Forgery Token nếu cần (ví dụ: 'RequestVerificationToken': token)
                }
            })
            .then(response => {
                if (!response.ok) {
                    // Xử lý lỗi HTTP (400, 500...)
                    throw new Error('Lỗi khi xóa bài viết. Trạng thái: ' + response.status);
                }
                // Nếu API trả về JSON
                return response.json();
            })
            .then(data => {
                if (data.status === 1) { // Giả sử status 1 là thành công
                    alert("Bài viết đã được xóa thành công!");

                    if (typeof UIkit !== 'undefined' && UIkit.modal) {
                        UIkit.modal('#postDeleteDialog').hide();
                    }

                    // Tải lại trang hoặc xóa bài viết khỏi DOM
                    location.reload();
                } else {
                    alert("Xóa thất bại: " + (data.message || "Lỗi không xác định."));
                }
            })
            .catch(error => {
                console.error('Lỗi khi gửi yêu cầu xóa:', error);
                alert("Đã xảy ra lỗi hệ thống: " + error.message);
            })
            .finally(() => {
                // Khôi phục nút
                confirmDeleteBtn.textContent = 'Xóa';
                confirmDeleteBtn.disabled = false;
                deleteConfirmationPostId.value = ''; // Xóa ID sau khi xử lý
            });
        });
    });
</script>